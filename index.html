<!DOCTYPE html>
<html>
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Container MM INFO (è²¨æ«ƒç®¡ç†è³‡è¨Š)</title>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-color: #4CAF50; --bg-color: #f7f9fc; --card-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --danger-color: #e53935; --copy-color: #FF9800; --view-color: #212121;
Â  Â  Â  Â  Â  Â  --frame-color: #4CAF50; --input-border: #ddd;
Â  Â  Â  Â  }
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color); margin: 0; padding: 0;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; min-height: 100vh;
Â  Â  Â  Â  }
Â  Â  Â  Â  #status-modal, #settings-modal {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.6); z-index: 9999;
Â  Â  Â  Â  Â  Â  display: none; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-box {
Â  Â  Â  Â  Â  Â  background: white; padding: 25px; border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 450px;
Â  Â  Â  Â  Â  Â  max-height: 90vh; overflow-y: auto;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .login-input {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px; font-size: 16px; text-align: left; box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .spinner {
Â  Â  Â  Â  Â  Â  border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
Â  Â  Â  Â  Â  Â  border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;
Â  Â  Â  Â  Â  Â  margin: 0 auto 15px auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #app-screen { width: 100%; max-width: 500px; padding: 10px; box-sizing: border-box; transition: max-width 0.3s ease; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
Â  Â  Â  Â  .header-btn {Â 
Â  Â  Â  Â  Â  Â  font-size: 24px; cursor: pointer; color: #555; padding: 6px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50%; transition: background 0.2s; width: 36px; height: 36px;Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-title { flex: 1; text-align: center; }Â 
Â  Â  Â  Â  .header-title h2 { margin: 0; color: #333; font-size: 1.6rem; line-height: 1.3; font-weight: 800; }

Â  Â  Â  Â  .card { background: var(--card-bg); padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 12px; }
Â  Â  Â  Â  .section-title { font-weight: bold; color: #555; margin-bottom: 8px; display: block; font-size: 1rem; }
Â  Â  Â  Â  .photo-controls { display: flex; gap: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .btn-half { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 5px;}
Â  Â  Â  Â  .btn-cam { background-color: #FF5722; color: white; }Â 
Â  Â  Â  Â  .btn-gallery { background-color: #FFC107; color: #333; }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  .preview-container-box {
Â  Â  Â  Â  Â  Â  max-width: 100%; height: auto; position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden;
Â  Â  Â  Â  Â  Â  background: #e0e0e0; border-radius: 8px; min-height: 150px; cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .ratio-4-3 { aspect-ratio: 4 / 3; } .ratio-16-9 { aspect-ratio: 16 / 9; } .ratio-9-16 { aspect-ratio: 9 / 16; } .ratio-1-1 { aspect-ratio: 1 / 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .preview-container-box .placeholder { position: absolute; color: #666; font-size: 1.1em; font-weight: bold; text-align: center; }
Â  Â  Â  Â  .preview-img-display { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: cover; display: none; }
Â  Â  Â  Â  .ratio-tag { position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.6); color: white; padding: 2px 5px; border-radius: 4px; font-size: 0.7rem; z-index: 10; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .input-group { margin-bottom: 8px; display: flex; flex-direction: column; }
Â  Â  Â  Â  .input-label { font-weight: bold; font-size: 0.9rem; color: #333; margin-bottom: 4px; }
Â  Â  Â  Â  .text-input, textarea, select.text-input {Â 
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; border: 1px solid var(--input-border);Â 
Â  Â  Â  Â  Â  Â  border-radius: 6px; font-size: 15px; box-sizing: border-box; font-family: inherit; transition: border-color 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  textarea { height: 80px; resize: vertical; }Â 
Â  Â  Â  Â  .time-component { display: flex; flex-direction: column; margin-bottom: 8px; }
Â  Â  Â  Â  .time-input-row { display: flex; align-items: center; gap: 5px; }
Â  Â  Â  Â  .btn-update-time { padding: 10px 12px; border: none; background-color: #00bcd4; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; line-height: 1; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .total-time-input-group { display: flex; gap: 5px; align-items: center; }
Â  Â  Â  Â  .total-time-input-group #input-total-time { flex-grow: 1; }
Â  Â  Â  Â  .total-time-input-group .btn-calc { padding: 10px; background: #607D8B; color: white; border: none; border-radius: 6px; cursor: pointer; }
Â  Â  Â  Â  .total-time-input-group #total-time-unit { width: 75px !important; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .footer-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; padding-bottom: 20px; }
Â  Â  Â  Â  .btn-main {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  height: 65px;Â 
Â  Â  Â  Â  Â  Â  padding: 5px; border: none; border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  font-size: 18px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 700; cursor: pointer; color: white;Â 
Â  Â  Â  Â  Â  Â  transition: background 0.2s, transform 0.1s;Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  align-items: center; justify-content: center;Â 
Â  Â  Â  Â  Â  Â  line-height: 1.1; text-align: center;
Â  Â  Â  Â  Â  Â  white-space: nowrap;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;Â  Â Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-main:active { transform: scale(0.99); }
Â  Â  Â  Â  .btn-save { background-color: var(--primary-color); } .btn-copy { background-color: var(--copy-color); }
Â  Â  Â  Â  .btn-view { background-color: #03A9F4; } .btn-drive { background-color: #795548; }

Â  Â  Â  Â  #recent-records-container { margin-top: 20px; padding: 15px; background: var(--card-bg); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
Â  Â  Â  Â  #recent-records-container h4 {
Â  Â  Â  Â  Â  Â  margin: 0 0 10px 0; color: var(--view-color); border-bottom: 1px solid #eee; padding-bottom: 8px;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .record-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; cursor: pointer; border-bottom: 1px dashed #f0f0f0; transition: background-color 0.2s; }
Â  Â  Â  Â  .record-item:last-child { border-bottom: none; } .record-item:hover { background-color: #f9f9f9; }
Â  Â  Â  Â  .record-item .main-info-group { display: flex; flex-direction: column; gap: 2px; flex-shrink: 0; width: 45%; }
Â  Â  Â  Â  .record-item .form-no-display { font-weight: bold; color: var(--copy-color); font-size: 1.1em; }
Â  Â  Â  Â  .record-item .stop-time-display { font-weight: bold; color: #333; font-size: 0.9em; }
Â  Â  Â  Â  .record-item .details { font-size: 0.85rem; color: #777; text-align: right; line-height: 1.4; width: 55%; }
Â  Â  Â  Â  .hidden { display: none !important; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-voice.recording { background-color: var(--danger-color); color: white; animation: pulse 1.5s infinite; }
Â  Â  Â  Â  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

Â  Â  Â  Â  @media (min-width: 900px) {
Â  Â  Â  Â  Â  Â  #app-screen { max-width: 1100px; }
Â  Â  Â  Â  Â  Â  .main-content-wrapper { display: flex; gap: 20px; align-items: flex-start; }
Â  Â  Â  Â  Â  Â  .left-photo-column { flex: 2; display: flex; flex-direction: column; gap: 15px; }
Â  Â  Â  Â  Â  Â  .right-info-column { flex: 3; }
Â  Â  Â  Â  Â  Â  .left-photo-column .card { margin-bottom: 0; }
Â  Â  Â  Â  Â  Â  .right-info-column .card:first-child { margin-top: 0; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="status-modal" style="display: none;">
Â  Â  Â  Â  <div class="modal-box">
Â  Â  Â  Â  Â  Â  <div id="status-spinner" class="spinner"></div>
Â  Â  Â  Â  Â  Â  <div id="status-icon" class="status-icon" style="display:none; font-size: 40px;"></div>
Â  Â  Â  Â  Â  Â  <h3 id="status-text" style="color:#333; margin:0;">Uploading...</h3>
Â  Â  Â  Â  Â  Â  <p id="status-subtext" style="color:#666; font-size:0.9em; margin-top:5px;">(è³‡æ–™ä¸Šå‚³ä¸­...)</p>
Â  Â  Â  Â  Â  Â  <button id="status-close-btn" onclick="closeStatusModal()" class="btn-main btn-view" style="margin-top: 15px; display: none;">OK</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="settings-modal" style="display: none;">
Â  Â  Â  Â  <div class="modal-box">
Â  Â  Â  Â  Â  Â  <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Settings (è¨­å®š)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeSettings()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="settings-content-group">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">1. Voice Timeout (ç§’)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="set-timeout" class="login-input" style="margin: 0;" placeholder="Default: 1.5">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">2. Photo Ratio</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-ratio" class="login-input" style="margin: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="4/3">4:3</option><option value="16/9">16:9</option><option value="9/16">9:16</option><option value="1/1">1:1</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">3. Recent Records Limit (é¡¯ç¤ºç­†æ•¸)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="set-recent-limit" class="login-input" style="margin: 0;" placeholder="Default: 5" min="1" max="30">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="font-weight: bold; margin-bottom: 5px; display: block;">4. Voice Language</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-lang" class="login-input" style="margin: 0;" onchange="syncLanguage()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">Chinese (TW)</option><option value="en-US">English</option><option value="ja-JP">Japanese</option><option value="hi-IN">Hindi</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" onclick="saveSettings()" style="margin-top:15px;">Save Settings</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="app-screen">
Â  Â  Â  Â  <div class="author-header">Author: DEREK LIN (v6.7)</div>
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <div style="width: 36px;"></div>Â 
Â  Â  Â  Â  Â  Â  <div class="header-title"><h2>Container MM INFO<br>è²¨æ«ƒç®¡ç†è³‡è¨Š</h2></div>
Â  Â  Â  Â  Â  Â  <div class="header-btn" onclick="openSettings()" title="Settings">âš™ï¸</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  <label class="input-label">Employee ID (å“¡å·¥ç·¨è™Ÿ):</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="input-employee-id" class="text-input" placeholder="å„²å­˜å¾Œä¸æœƒæ¸…é™¤">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="main-content-wrapper">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="left-photo-column">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="section-title">1. Truck Plate Photo (è»Šç‰Œè™Ÿç¢¼ç…§ç‰‡)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="photo-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-cam" onclick="triggerFile('input-cam_1')">ğŸ“· Camera A</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-gallery" onclick="triggerFile('input-gallery_1')">ğŸ–¼ï¸ Gallery A</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-container_1" class="preview-container-box ratio-4-3" onclick="triggerFile('input-cam_1')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ratio-tag" id="ratio-display-tag_1">Ratio: 4:3</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="placeholder_1" class="placeholder">Tap here for Photo A</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img_1" class="preview-img-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-cam_1" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this, 1)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-gallery_1" accept="image/*" class="hidden" onchange="handleFile(this, 1)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="section-title">2. Material Photo (åŸææ–™ç…§ç‰‡)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="photo-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-cam" onclick="triggerFile('input-cam_2')">ğŸ“· Camera B</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-gallery" onclick="triggerFile('input-gallery_2')">ğŸ–¼ï¸ Gallery B</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-container_2" class="preview-container-box ratio-4-3" onclick="triggerFile('input-cam_2')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ratio-tag" id="ratio-display-tag_2">Ratio: 4:3</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="placeholder_2" class="placeholder">Tap here for Photo B</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img_2" class="preview-img-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-cam_2" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this, 2)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-gallery_2" accept="image/*" class="hidden" onchange="handleFile(this, 2)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="section-title">3. Empty Container Photo (ç©ºæ«ƒç…§ç‰‡)</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="photo-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-cam" onclick="triggerFile('input-cam_3')">ğŸ“· Camera C</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-gallery" onclick="triggerFile('input-gallery_3')">ğŸ–¼ï¸ Gallery C</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="preview-container_3" class="preview-container-box ratio-4-3" onclick="triggerFile('input-cam_3')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ratio-tag" id="ratio-display-tag_3">Ratio: 4:3</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="placeholder_3" class="placeholder">Tap here for Photo C</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img_3" class="preview-img-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-cam_3" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this, 3)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="input-gallery_3" accept="image/*" class="hidden" onchange="handleFile(this, 3)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="right-info-column">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card" id="info-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="section-title">2. Container Information</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="voice-lang-select" class="text-input" onchange="syncLanguageToSettings(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">Chinese (TW) - ç¹é«”ä¸­æ–‡</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="en-US">English - è‹±æ–‡</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ja-JP">Japanese - æ—¥æ–‡</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="hi-IN">Hindi - å°åœ°èª</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">SAP CODE (ç³»çµ±ä»£ç¢¼):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-machine" class="text-input" placeholder="è¼¸å…¥ SAP Code">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Material Name (ææ–™åç¨±):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-form-no" class="text-input" placeholder="è¼¸å…¥ææ–™åç¨±">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-component">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Arrival Time (åˆ°é”æ™‚é–“): (DD/MM/YYYY hh:mm) (IST)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-start-time-full" class="text-input" placeholder="è«‹é»å³å´æŒ‰éˆ•æˆ–æ‰‹å‹•è¼¸å…¥" oninput="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-update-time" onclick="updateSingleTime('input-start-time-full')"><span style="font-size: 1.1em;">â±ï¸</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-component">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">End time (çµæŸæ™‚é–“): (DD/MM/YYYY hh:mm) (IST)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time-input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-stop-time-full" class="text-input" placeholder="è«‹é»å³å´æŒ‰éˆ•æˆ–æ‰‹å‹•è¼¸å…¥" oninput="calculateTotalStopTime()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-update-time" onclick="updateSingleTime('input-stop-time-full')"><span style="font-size: 1.1em;">â±ï¸</span></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Total time (ç¸½æ™‚é–“):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="total-time-input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-total-time" class="text-input" readonly style="background-color: #eee; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-calc" onclick="calculateTotalStopTime()" title="Recalculate">ğŸ”„</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="total-time-unit" onchange="calculateTotalStopTime()" class="text-input"><option value="min" selected>min</option><option value="h">hr</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Truck No (ç­æ¬¡):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-truck-num" class="text-input" placeholder="è¼¸å…¥ç­æ¬¡ (e.g. 1)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Number of Truck (è»Šç‰Œ):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-plate-num" class="text-input" placeholder="è¼¸å…¥è»Šç‰Œè™Ÿç¢¼">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">RW Material Weight (åŸææ–™é‡é‡):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="input-concern-section" class="text-input" placeholder="Enter Weight" oninput="calculateTotalStock()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">MX Stock (MX åº«å­˜):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="input-reason" class="text-input" placeholder="Enter MX Stock" oninput="calculateTotalStock()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">WH Stock (WH åº«å­˜):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="input-solution" class="text-input" placeholder="Enter WH Stock" oninput="calculateTotalStock()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Total Stock (ç¸½åº«å­˜):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-total-stock" class="text-input" readonly style="background-color: #eee; font-weight: bold;" placeholder="Auto Calc">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="input-label">Notes (å‚™è¨»):</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="input-self-actions"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-control-group"><button type="button" class="btn-voice" data-target="input-self-actions" onclick="toggleVoice(this)">ğŸ¤ èªéŸ³è¼¸å…¥</button></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="recent-records-container" class="card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>æœ€è¿‘ç´€éŒ„ (Recent Records)</h4> <div id="recent-records-list"><p style="text-align: center; color: #999;">Loading recent records...</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="footer-btns">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-main btn-copy" onclick="copyFormattedInfo()">ğŸ“‹ Copy</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" id="saveBtn" onclick="saveToCloud()">ğŸ’¾ Save</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-main btn-view" onclick="viewExcel()">ğŸ“Š Excel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-main btn-drive" onclick="viewDriveFolder()">ğŸ“‚ Photos</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  </div>Â 
Â  Â  </div>

<script>
Â  Â  const MAX_IMAGE_WIDTH = 1000;
Â  Â  const MACHINE_LIST_KEY = "cfg_machine_list"; const CONCERN_LIST_KEY = "cfg_concern_list"; const EMPLOYEE_ID_KEY = "cfg_employee_id";
Â  Â  const DEFAULT_MACHINE_LIST = [];
Â  Â  const DEFAULT_CONCERN_LIST = [];
Â  Â  const DEFAULT_VOICE_TIMEOUT = 1.5;
Â  Â  const DEFAULT_RECENT_LIMIT = 5;

Â  Â  // TODO: âš ï¸ è«‹å‹™å¿…å°‡ä¸‹æ–¹ä¸‰å€‹ ID æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„è³‡æ–™ âš ï¸
Â  Â  const FIXED_SCRIPT_ID = "AKfycbxX-XRuXqIB7JJopFGYaHtiAk6kZfe19bFihOd7HCxrA-ffKQGXDoIfJwwPYFLZER8c/exec";Â 
Â  Â  const FIXED_SHEET_ID = "1OFXZ7fb2AU0iN1I0viHmlpykA_v_JEUaSdluqtF-L_c/edit?gid=0#gid=0";Â 
Â  Â  const FIXED_FOLDER_ID = "1j7Z4EuAFFmdA7w46eoDxun77SD2KxsTe";Â 
Â  Â  Â Â 
Â  Â  const GAS_URL = `https://script.google.com/macros/s/${FIXED_SCRIPT_ID}/exec`;

Â  Â  let processedImages = { 1: "", 2: "", 3: "" };
Â  Â  let recognition = null, isRecording = false, activeTextAreaId = null;
Â  Â  let initialText = "", currentSessionFinal = "", punctuationTimer = null;Â 

Â  Â  document.addEventListener('DOMContentLoaded', () => { initApp(); });

Â  Â  function initApp() {
Â  Â  Â  Â  if(!localStorage.getItem(MACHINE_LIST_KEY)) localStorage.setItem(MACHINE_LIST_KEY, JSON.stringify(DEFAULT_MACHINE_LIST));
Â  Â  Â  Â  if(!localStorage.getItem(CONCERN_LIST_KEY)) localStorage.setItem(CONCERN_LIST_KEY, JSON.stringify(DEFAULT_CONCERN_LIST));
Â  Â  Â  Â  if(!localStorage.getItem("cfg_timeout")) localStorage.setItem("cfg_timeout", DEFAULT_VOICE_TIMEOUT);
Â  Â  Â  Â  if(!localStorage.getItem("cfg_recent_limit")) localStorage.setItem("cfg_recent_limit", DEFAULT_RECENT_LIMIT);
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadSettingsToUI(); loadEmployeeID();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('input-stop-time-full').value = ""; document.getElementById('input-start-time-full').value = "";
Â  Â  Â  Â  document.getElementById('input-total-time').value = ""; document.getElementById('input-total-time').style.backgroundColor = '#eee';
Â  Â  Â  Â  document.getElementById('total-time-unit').value = "min";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  Â  Â  applySettings(); loadRecentRecords();
Â  Â  }

Â  Â  function openSettings(){document.getElementById('settings-modal').style.display='flex';}
Â  Â  function closeSettings(){document.getElementById('settings-modal').style.display='none'}
Â  Â  function saveSettings(){
Â  Â  Â  Â  const t=parseFloat(document.getElementById('set-timeout').value);if(!isNaN(t))localStorage.setItem("cfg_timeout",t);
Â  Â  Â  Â  const limit = parseInt(document.getElementById('set-recent-limit').value);
Â  Â  Â  Â  if(!isNaN(limit) && limit > 0) localStorage.setItem("cfg_recent_limit", limit);

Â  Â  Â  Â  localStorage.setItem("cfg_ratio",document.getElementById('set-ratio').value);
Â  Â  Â  Â  localStorage.setItem("cfg_lang",document.getElementById('set-lang').value);
Â  Â  Â  Â  alert("Saved!");closeSettings();applySettings();
Â  Â  Â  Â  loadRecentRecords();
Â  Â  }
Â  Â  function loadSettingsToUI(){
Â  Â  Â  Â  document.getElementById('set-timeout').value=localStorage.getItem("cfg_timeout")||DEFAULT_VOICE_TIMEOUT;
Â  Â  Â  Â  document.getElementById('set-ratio').value=localStorage.getItem("cfg_ratio")||'4/3';
Â  Â  Â  Â  document.getElementById('set-lang').value=localStorage.getItem("cfg_lang")||'cmn-Hant-TW';
Â  Â  Â  Â  document.getElementById('set-recent-limit').value = localStorage.getItem("cfg_recent_limit") || DEFAULT_RECENT_LIMIT;
Â  Â  }
Â  Â Â 
Â  Â  function applySettings(){
Â  Â  Â  Â  const r=localStorage.getItem("cfg_ratio")||'4/3';
Â  Â  Â  Â  const ratioClass = r==='4/3'?'ratio-4-3':r==='16/9'?'ratio-16-9':r==='9/16'?'ratio-9-16':'ratio-1-1';
Â  Â  Â  Â  [1, 2, 3].forEach(num => {
Â  Â  Â  Â  Â  Â  const c = document.getElementById(`preview-container_${num}`);
Â  Â  Â  Â  Â  Â  if (c) {
Â  Â  Â  Â  Â  Â  Â  Â  c.className = 'preview-container-box';Â 
Â  Â  Â  Â  Â  Â  Â  Â  c.classList.add(ratioClass);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`ratio-display-tag_${num}`).innerText=`Ratio: ${r.replace('/',':')}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  const l = localStorage.getItem("cfg_lang")||'cmn-Hant-TW';
Â  Â  Â  Â  document.getElementById('voice-lang-select').value = l;
Â  Â  Â  Â  document.getElementById('set-lang').value = l;
Â  Â  }
Â  Â  function syncLanguage(){localStorage.setItem("cfg_lang",document.getElementById('set-lang').value);document.getElementById('voice-lang-select').value=document.getElementById('set-lang').value}
Â  Â  function syncLanguageToSettings(el){localStorage.setItem("cfg_lang",el.value);document.getElementById('set-lang').value=el.value}

Â  Â  function loadEmployeeID(){const v=localStorage.getItem(EMPLOYEE_ID_KEY);if(v)document.getElementById('input-employee-id').value=v}
Â  Â  function saveEmployeeID(){const v=document.getElementById('input-employee-id').value.trim();if(v)localStorage.setItem(EMPLOYEE_ID_KEY,v)}
Â  Â Â 
Â  Â  const DATETIME_REGEX = /^(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2})$/;
Â  Â  function parseCustomDateTime(dtStr) {
Â  Â  Â  Â  if(!dtStr) return null;
Â  Â  Â  Â  const s = dtStr.trim();Â 
Â  Â  Â  Â  const match = s.match(DATETIME_REGEX);
Â  Â  Â  Â  if (!match) return null;
Â  Â  Â  Â  const day = parseInt(match[1], 10);
Â  Â  Â  Â  const month = parseInt(match[2], 10) - 1;Â 
Â  Â  Â  Â  const year = parseInt(match[3], 10);
Â  Â  Â  Â  const hour = parseInt(match[4], 10);
Â  Â  Â  Â  const minute = parseInt(match[5], 10);
Â  Â  Â  Â  const date = new Date(year, month, day, hour, minute);
Â  Â  Â  Â  if (date.getFullYear() !== year || date.getMonth() !== month || date.getDate() !== day) return null;
Â  Â  Â  Â  return date;
Â  Â  }
Â  Â Â 
Â  Â  function calculateTotalStopTime() {
Â  Â  Â  Â  const s1 = document.getElementById('input-start-time-full').value;Â 
Â  Â  Â  Â  const s2 = document.getElementById('input-stop-time-full').value;Â 
Â  Â  Â  Â  const t = document.getElementById('input-total-time');
Â  Â  Â  Â  const u = document.getElementById('total-time-unit').value;
Â  Â  Â  Â  if(!s1||!s2){ t.value=""; t.style.background='#eee'; return; }
Â  Â  Â  Â  const d1 = parseCustomDateTime(s1);
Â  Â  Â  Â  const d2 = parseCustomDateTime(s2);
Â  Â  Â  Â  if(!d1||!d2){ t.value="Invalid Format"; t.style.background='#fdd'; return; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const diff = Math.round((d2 - d1) / 60000);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(diff <= 0){ t.value="0 (Check Time)"; t.style.background='#fdd'; return; }
Â  Â  Â  Â  t.value = u === 'h' ? (diff/60).toFixed(2) + " hr" : diff + " min";
Â  Â  Â  Â  t.style.background='#e6ffed';
Â  Â  }

Â  Â  function calculateTotalStock() {
Â  Â  Â  Â  const inbound = parseFloat(document.getElementById('input-concern-section').value) || 0;Â 
Â  Â  Â  Â  const mxStock = parseFloat(document.getElementById('input-reason').value) || 0;Â 
Â  Â  Â  Â  const whStock = parseFloat(document.getElementById('input-solution').value) || 0;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const total = inbound + mxStock + whStock;
Â  Â  Â  Â  document.getElementById('input-total-stock').value = total;
Â  Â  }
Â  Â Â 
Â  Â  function getFullDateTimeString(dateObj) {
Â  Â  Â  Â  const utc = dateObj.getTime() + (dateObj.getTimezoneOffset() * 60000);
Â  Â  Â  Â  const istDate = new Date(utc + (3600000 * 5.5));
Â  Â  Â  Â  const day = String(istDate.getDate()).padStart(2, '0');
Â  Â  Â  Â  const month = String(istDate.getMonth() + 1).padStart(2, '0');
Â  Â  Â  Â  const year = istDate.getFullYear();
Â  Â  Â  Â  const hour = String(istDate.getHours()).padStart(2, '0');
Â  Â  Â  Â  const minute = String(istDate.getMinutes()).padStart(2, '0');
Â  Â  Â  Â  return `${day}/${month}/${year} ${hour}:${minute}`;
Â  Â  }
Â  Â  function updateSingleTime(id){const n=new Date();document.getElementById(id).value=getFullDateTimeString(n);calculateTotalStopTime()}
Â  Â Â 
Â  Â  function loadRecentRecords(){
Â  Â  Â  Â  const listContainer=document.getElementById('recent-records-list');listContainer.innerHTML='<p style="text-align: center; color: #999;">Loading...</p>';
Â  Â  Â  Â  const limit = parseInt(localStorage.getItem("cfg_recent_limit")) || DEFAULT_RECENT_LIMIT;

Â  Â  Â  Â  fetch(`${GAS_URL}?action=loadRecords`).then(r=>r.json()).then(res=>{
Â  Â  Â  Â  Â  Â  listContainer.innerHTML='';
Â  Â  Â  Â  Â  Â  if(res.result==='success'&&res.data.length>0){
Â  Â  Â  Â  Â  Â  Â  Â  const recordsToShow = res.data.slice(0, limit);
Â  Â  Â  Â  Â  Â  Â  Â  recordsToShow.forEach(r=>{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const i=document.createElement('div');i.className='record-item';i.setAttribute('onclick',`populateForm('${r.formNo}')`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  i.innerHTML=`<div class="main-info-group"><span class="form-no-display">#${r.formNo||'N/A'}</span><span class="stop-time-display">ğŸ›‘ ${r.stopTime||"No Time"}</span></div><div class="details"><div>${r.machine||'N/A'} - ${r.truckNum||'No Plate'}</div><div>${r.startTime?'Arr: '+r.startTime:''}</div></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listContainer.appendChild(i)
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  }else{listContainer.innerHTML='<p style="text-align: center; color: #999;">ç„¡æœ€è¿‘ç´€éŒ„ã€‚</p>'}
Â  Â  Â  Â  }).catch(e=>{listContainer.innerHTML='<p style="text-align: center; color: red;">âŒ è¼‰å…¥å¤±æ•—ã€‚</p>'})
Â  Â  }

Â  Â  function populateForm(f){
Â  Â  Â  Â  if(!confirm(`å›å¡«å–®è™Ÿ [${f}]?`))return;showStatus('loading','Loading...',f);
Â  Â  Â  Â  fetch(`${GAS_URL}?action=getRow&formNo=${encodeURIComponent(f)}`).then(r=>r.json()).then(res=>{
Â  Â  Â  Â  Â  Â  if(res.result==='success'){
Â  Â  Â  Â  Â  Â  Â  Â  const d=res.data;
Â  Â  Â  Â  Â  Â  Â  Â  processedImages = { 1: "", 2: "", 3: "" };
Â  Â  Â  Â  Â  Â  Â  Â  [1, 2, 3].forEach(num => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById(`preview-img_${num}`).style.display='none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById(`placeholder_${num}`).style.display='block';
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-employee-id').value=d.employeeId;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-machine').value=d.machine;Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-form-no').value=d.formNo;Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-stop-time-full').value=d.stopTimeFull?d.stopTimeFull.trim():"";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-start-time-full').value=d.startTimeFull?d.startTimeFull.trim():"";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-concern-section').value=d.concernSection;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-reason').value=d.reason;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-solution').value=d.solution;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-self-actions').value=d.selfActions;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-truck-num').value=d.shiftNum || "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('input-plate-num').value=d.plateNum || "";Â 

Â  Â  Â  Â  Â  Â  Â  Â  calculateTotalStopTime();
Â  Â  Â  Â  Â  Â  Â  Â  calculateTotalStock();Â 
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('success','Loaded','');setTimeout(closeStatusModal,1000)
Â  Â  Â  Â  Â  Â  }else{showStatus('error','Failed',res.error)}
Â  Â  Â  Â  }).catch(e=>showStatus('error','Error','Network'))
Â  Â  }
Â  Â Â 
Â  Â  function triggerFile(id){document.getElementById(id).click()}

Â  Â  function handleFile(i, slotNum){
Â  Â  Â  Â  if(i.files[0]){
Â  Â  Â  Â  Â  Â  showStatus('loading','Processing...','');
Â  Â  Â  Â  Â  Â  const r=new FileReader();
Â  Â  Â  Â  Â  Â  r.onload=e=>{const img=new Image();img.onload=()=>processImageWithCanvas(img, slotNum);img.src=e.target.result};
Â  Â  Â  Â  Â  Â  r.readAsDataURL(i.files[0])
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function processImageWithCanvas(img, slotNum){
Â  Â  Â  Â  const c=document.createElement('canvas');let w=img.width;let h=img.height;if(w>MAX_IMAGE_WIDTH){h=Math.round(h*(MAX_IMAGE_WIDTH/w));w=MAX_IMAGE_WIDTH}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);
Â  Â  Â  Â  processedImages[slotNum] = c.toDataURL('image/jpeg',0.8);
Â  Â  Â  Â  document.getElementById(`preview-img_${slotNum}`).src = processedImages[slotNum];
Â  Â  Â  Â  document.getElementById(`preview-img_${slotNum}`).style.display='block';
Â  Â  Â  Â  document.getElementById(`placeholder_${slotNum}`).style.display='none';
Â  Â  Â  Â  closeStatusModal();
Â  Â  }
Â  Â Â 
Â  Â  function toggleVoice(button) {
Â  Â  Â  Â  if (!('webkitSpeechRecognition' in window)) { alert("è«‹ä½¿ç”¨ Chrome ç€è¦½å™¨"); return; }
Â  Â  Â  Â  if (isRecording) { manualStopVoice(); } else { activeTextAreaId = button.dataset.target; startVoice(button); }
Â  Â  }

Â  Â  function startVoice(button) {
Â  Â  Â  Â  isRecording = true; button.classList.add('recording'); button.innerHTML = 'ğŸ”´ éŒ„éŸ³ä¸­...';
Â  Â  Â  Â  recognition = new webkitSpeechRecognition(); recognition.continuous = true; recognition.interimResults = true;
Â  Â  Â  Â  recognition.lang = document.getElementById('voice-lang-select').value;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const targetElement = document.getElementById(activeTextAreaId);
Â  Â  Â  Â Â 
Â  Â  Â  Â  initialText = targetElement.value;Â 
Â  Â  Â  Â  if (initialText.length > 0 && !initialText.endsWith(' ') && !initialText.endsWith('\n')) {
Â  Â  Â  Â  Â  Â  initialText += ' ';
Â  Â  Â  Â  }
Â  Â  Â  Â  currentSessionFinal = '';Â 

Â  Â  Â  Â  recognition.onstart = function() { clearTimeout(punctuationTimer); };

Â  Â  Â  Â  recognition.onresult = function(event) {
Â  Â  Â  Â  Â  Â  clearTimeout(punctuationTimer);Â 
Â  Â  Â  Â  Â  Â  let interimTranscript = '';
Â  Â  Â  Â  Â  Â  currentSessionFinal = '';Â 

Â  Â  Â  Â  Â  Â  for (let i = event.resultIndex; i < event.results.length; ++i) {
Â  Â  Â  Â  Â  Â  Â  Â  if (event.results[i].isFinal) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSessionFinal += event.results[i][0].transcript;Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interimTranscript += event.results[i][0].transcript;Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  targetElement.value = initialText + currentSessionFinal + interimTranscript;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const timeout = parseFloat(localStorage.getItem("cfg_timeout") || DEFAULT_VOICE_TIMEOUT) * 1000;
Â  Â  Â  Â  Â  Â  punctuationTimer = setTimeout(manualStopVoice, timeout);
Â  Â  Â  Â  };

Â  Â  Â  Â  recognition.onerror = function(event) {
Â  Â  Â  Â  Â  Â  console.error('Error:', event.error);
Â  Â  Â  Â  Â  Â  if(event.error === 'no-speech') { }
Â  Â  Â  Â  Â  Â  else { resetVoiceUI(); alert('èªéŸ³éŒ¯èª¤: ' + event.error); }
Â  Â  Â  Â  };

Â  Â  Â  Â  recognition.onend = function() {
Â  Â  Â  Â  Â  Â  if (isRecording) {
Â  Â  Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(activeTextAreaId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(el) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initialText = el.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (initialText.length > 0 && !initialText.endsWith(' ') && !initialText.endsWith('\n')) { initialText += ' '; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentSessionFinal = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.start();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) { console.warn("Restart failed"); }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  try { recognition.start(); } catch(e) { console.warn("Start failed"); }
Â  Â  }

Â  Â  function manualStopVoice() {
Â  Â  Â  Â  isRecording = false;Â 
Â  Â  Â  Â  if (recognition) {Â 
Â  Â  Â  Â  Â  Â  clearTimeout(punctuationTimer);Â 
Â  Â  Â  Â  Â  Â  recognition.stop();Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  resetVoiceUI();
Â  Â  }

Â  Â  function resetVoiceUI() {
Â  Â  Â  Â  isRecording = false; document.querySelectorAll('.btn-voice').forEach(b=>{b.classList.remove('recording');b.innerText='ğŸ¤ èªéŸ³è¼¸å…¥'}); activeTextAreaId = null;
Â  Â  }

Â  Â  function showStatus(t,h,s){const m=document.getElementById('status-modal');document.getElementById('status-text').innerText=h;document.getElementById('status-subtext').innerText=s;document.getElementById('status-spinner').style.display=t==='loading'?'block':'none';document.getElementById('status-icon').style.display=t!=='loading'?'block':'none';document.getElementById('status-close-btn').style.display=t!=='loading'?'block':'none';document.getElementById('status-icon').innerText=t==='success'?'âœ…':'âŒ';m.style.display='flex'}
Â  Â  function closeStatusModal(){document.getElementById('status-modal').style.display='none'}
Â  Â Â 
Â  Â  function copyFormattedInfo(){
Â  Â  Â  Â  // å¼·åˆ¶è¨ˆç®—ä¸€æ¬¡ï¼Œç¢ºä¿è¤‡è£½æ™‚è³‡æ–™æ˜¯æœ€æ–°çš„
Â  Â  Â  Â  calculateTotalStopTime();
Â  Â  Â  Â  calculateTotalStock();

Â  Â  Â  Â  const emp = document.getElementById('input-employee-id').value || "N/A";
Â  Â  Â  Â  const sapCode = document.getElementById('input-machine').value || "N/A";
Â  Â  Â  Â  const material = document.getElementById('input-form-no').value || "N/A";
Â  Â  Â  Â  const arrTime = document.getElementById('input-start-time-full').value || "";
Â  Â  Â  Â  const endTime = document.getElementById('input-stop-time-full').value || "";
Â  Â  Â  Â  const totalTime = document.getElementById('input-total-time').value || "N/A";

Â  Â  Â  Â  const shiftNum = document.getElementById('input-truck-num').value || "N/A";Â 
Â  Â  Â  Â  const plateNum = document.getElementById('input-plate-num').value || "N/A";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const inboundWeight = document.getElementById('input-concern-section').value || "N/A";
Â  Â  Â  Â  const mxStock = document.getElementById('input-reason').value || "N/A";
Â  Â  Â  Â  const whStock = document.getElementById('input-solution').value || "N/A";
Â  Â  Â  Â  const totalStock = document.getElementById('input-total-stock').value || "N/A";
Â  Â  Â  Â  const notes = document.getElementById('input-self-actions').value || "";

Â  Â  Â  Â  if (sapCode === "N/A" && material === "N/A") {
Â  Â  Â  Â  Â  Â  alert("è«‹è‡³å°‘å¡«å¯« SAP CODE èˆ‡ Material Name");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const textToCopy =Â 
`ã€Container Recordã€‘
Â Â 
SAP CODE:
${sapCode}

Material Name :
${material}

-----------------------
Arrival Time :
${arrTime}

End time :
${endTime}

Total time : ${totalTime}

---------------------
Truck No: ${shiftNum}

Number of Truck :Â 
${plateNum}

---------------------
RW Material Weight:
${inboundWeight}

MX Stock: ${mxStock}
WH Stock: ${whStock}

Total Stock: ${totalStock}

--------------------
ID_${emp} :
${notes}`;

Â  Â  Â  Â  navigator.clipboard.writeText(textToCopy.trim())
Â  Â  Â  Â  Â  Â  .then(() => alert("Copied! (å·²è¤‡è£½)"))
Â  Â  Â  Â  Â  Â  .catch(err => alert("Copy failed: " + err));
Â  Â  }

Â  Â  function viewExcel(){window.open(`https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/edit`,'_blank')}
Â  Â  function viewDriveFolder(){window.open(`https://drive.google.com/drive/folders/${FIXED_FOLDER_ID}`,'_blank')}
Â  Â Â 
Â  Â  function clearInputs(){
Â  Â  Â  Â  document.getElementById('input-machine').value="";
Â  Â  Â  Â  document.getElementById('input-form-no').value="";
Â  Â  Â  Â  document.getElementById('input-stop-time-full').value="";
Â  Â  Â  Â  document.getElementById('input-start-time-full').value="";
Â  Â  Â  Â  document.getElementById('input-total-time').value="";
Â  Â  Â  Â  document.getElementById('input-truck-num').value="";
Â  Â  Â  Â  document.getElementById('input-plate-num').value="";Â 
Â  Â  Â  Â  document.getElementById('input-concern-section').value="";
Â  Â  Â  Â  document.getElementById('input-reason').value="";
Â  Â  Â  Â  document.getElementById('input-solution').value="";
Â  Â  Â  Â  document.getElementById('input-total-stock').value="";
Â  Â  Â  Â  document.getElementById('input-self-actions').value="";
Â  Â  Â  Â Â 
Â  Â  Â  Â  processedImages = { 1: "", 2: "", 3: "" };
Â  Â  Â  Â  [1, 2, 3].forEach(num => {
Â  Â  Â  Â  Â  Â  Â document.getElementById(`preview-img_${num}`).style.display='none';
Â  Â  Â  Â  Â  Â  Â document.getElementById(`preview-img_${num}`).src="";
Â  Â  Â  Â  Â  Â  Â document.getElementById(`placeholder_${num}`).style.display='block';
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  calculateTotalStopTime();
Â  Â  }

Â  Â  function saveToCloud(){
Â  Â  Â  Â  if(isRecording)manualStopVoice();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let noteContent = document.getElementById('input-self-actions').value;
Â  Â  Â  Â  const plateNum = document.getElementById('input-plate-num').value;Â 
Â  Â  Â  Â  const shiftNum = document.getElementById('input-truck-num').value;Â 

Â  Â  Â  Â  const d={
Â  Â  Â  Â  Â  Â  image1: processedImages[1],
Â  Â  Â  Â  Â  Â  image2: processedImages[2],
Â  Â  Â  Â  Â  Â  image3: processedImages[3],Â 
Â  Â  Â  Â  Â  Â  employeeId:document.getElementById('input-employee-id').value,
Â  Â  Â  Â  Â  Â  machine:document.getElementById('input-machine').value,
Â  Â  Â  Â  Â  Â  formNo:document.getElementById('input-form-no').value,
Â  Â  Â  Â  Â  Â  startTimeFull:document.getElementById('input-start-time-full').value,
Â  Â  Â  Â  Â  Â  stopTimeFull:document.getElementById('input-stop-time-full').value,
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  truckNum: plateNum,Â 
Â  Â  Â  Â  Â  Â  shiftNum: shiftNum,
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  concernSection:document.getElementById('input-concern-section').value,
Â  Â  Â  Â  Â  Â  reason:document.getElementById('input-reason').value,
Â  Â  Â  Â  Â  Â  solution:document.getElementById('input-solution').value,
Â  Â  Â  Â  Â  Â  selfActions:noteContent,Â 
Â  Â  Â  Â  Â  Â  folderId:FIXED_FOLDER_ID
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(!d.formNo){alert("Material Name required");return}
Â  Â  Â  Â  saveEmployeeID();showStatus('loading','Uploading...','');
Â  Â  Â  Â  fetch(GAS_URL,{method:'POST',body:JSON.stringify(d)}).then(r=>r.json()).then(res=>{if(res.result==='success'){showStatus('success','Saved!',res.action);clearInputs();loadRecentRecords();setTimeout(closeStatusModal,2000)}else{showStatus('error','Failed',res.error)}}).catch(e=>showStatus('error','Error',e.message)).finally(()=>document.getElementById('saveBtn').disabled=false);
Â  Â  }
</script>
</body>
</html>
